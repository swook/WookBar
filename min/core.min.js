/*!
   jQuery WookBar for Blogger
   - Core File
 */
var WB={l:"#mynavbar .right .cont a",u:"#mynavbar .right .cont",blog:{posts:[],pages:[]},data:{items:[],urls:{}},init:function(){var a=_WidgetManager._GetAllData().blog;WB.blog.title=a.title;WB.blog.homepage=a.canonicalHomepageUrl;$("#topbar-search")[0].defaultValue="Search "+WB.blog.title;var b=function(f,d){var c,e;$.each(f,function(g,h){c={};c.id=g;c.type=d;c.date=new Date(h.published.$t);c.title=h.title.$t;c.content=h.content.$t;c.link=h.link[h.link.length-1].href;c.labels=[];c.labelsLower=[];if("media$thumbnail" in h){c.thumbnail=h.media$thumbnail.url}if(h.category){$.each(h.category,function(k,j){c.labels.push(j.term);c.labelsLower.push(j.term.toLowerCase())})}e=WB.data.items.push(c)-1;WB.data.urls[$.Ajaxify.parseUri(c.link).full]=e;switch(d){case"post":WB.blog.posts.push(e);case"page":WB.blog.pages.push(e)}});c=null};$.getJSON("/feeds/posts/default?orderby=published&alt=json",function(c){b(c.feed.entry,"post");c=null});$.getJSON("/feeds/pages/default?orderby=published&alt=json",function(c){b(c.feed.entry,"page");c=null});delete b;$("#mynavbar form").submit(function(c){c.preventDefault()});$("#topbar-search").focus(WB.input.focus).blur(WB.input.blur).keydown(WB.input.keydown).keyup(WB.input.keyup);$("#mynavbar .right").on("mouseleave",WB.ul.mouseleave).on("mouseenter",WB.ul.mouseenter);$("#mynavbar .right .cont").on("mouseleave",WB.ul.mouseleave).on("mouseenter",WB.ul.mouseenter);$(document).on("keydown",WB.global_enterTrap.keydown).on("keyup",WB.global_enterTrap.keyup)},global_enterTrap:{keydown:function(b){var a=$("input:focus");if(a.length==0&&b.keyCode==13){WB.global_enterTrap.pressed=true}},keyup:function(b){var a=$("input:focus");if(WB.global_enterTrap.pressed&&a.length==0&&b.keyCode==13){$("#topbar-search").focus()}WB.global_enterTrap.pressed=false},pressed:false},search:function(){var a=$("#topbar-search"),c=a.val().toLowerCase().replace(/^\s+|\s+$/g,"");if(WB.data.items.length&&!("contentText" in WB.data.items[0])){WB.data.items.forEach(function(e){e.contentText=e.content.replace(/(<([^>]+)>)/ig," ");e.snippet=e.contentText.substr(0,120);e.contentTextLower=e.contentText.toLowerCase()})}if(WB.data.lastTerm==c){WB.unhide()}else{if(c==a[0].defaultValue||c==""){WB.showProgress();c="",WB.data.search=[];$.each(WB.data.items,function(e,f){if(f.type=="post"){WB.data.search.push({id:e})}});WB.show()}else{WB.showProgress();WB.data.search=[];var b=c.split(" ");$.each(WB.data.items,function(f,g){var e={},d=0;d+=(g.title.split(c).length-1)*6/g.title.length;d+=(g.contentTextLower.split(c).length-1)*4/g.contentTextLower.length;$.each(b,function(h,j){d+=(g.title.split(j).length-1)*1.5/g.title.length;d+=(g.contentTextLower.split(j).length-1)*0.4/g.contentTextLower.length;$.each(g.labelsLower,function(m,k){if(k.indexOf(j)>-1){d+=2/g.labelsLower.length}})});e.id=f;e.point=d;if(d>0){WB.data.search.push(e)}});WB.data.search.sort(function(e,d){return d.point-e.point});WB.clear();WB.show()}}WB.data.lastTerm=c},show:function(){var d=$('<div class="cont"><div class="shadow topshadow"/></div>'),e,a;if(WB.data.search.length==0){WB.clear();d.append($("<a><strong>No Search Results</strong></a>"));$("#mynavbar .right").append(d);WB.endProgress();return}$.each(WB.data.search,function(f,i){i=WB.data.items[i.id];a=false;if(e){if(e.getUTCMonth()!=i.date.getUTCMonth()){e=i.date;a=true}else{if(e.getUTCFullYear()!=i.date.getUTCFullYear()){e=i.date;a=true}}}else{e=i.date,a=true}if(a){d.append('<div class="date">'+WB.Ajaxify.tmpl.getMonth(i.date.getUTCMonth())+" "+i.date.getUTCFullYear()+"</div>")}var g,h=$('<a href="'+i.link+'" title="'+i.title+'"/>');g='<div class="title">'+i.title+"</div>";if("thumbnail" in i){g+='<img class="thumbnail" src="'+i.thumbnail+'"/>'}g+='<p class="desc">'+i.snippet+"</p>";h.html(g);d.append(h)});d.append('<div class="shadow bottomshadow"/><div class="scrollbar"/>');$("#mynavbar .right").append(d);$(WB.l).each(function(){$(this).on("click",WB.li.click)});var c=$(WB.u),b=window.innerHeight-26;c.height("auto");if(c.height()>b){c.height(b);c.on("mousemove",WB.ul.mousemove).on("mousedown",WB.ul.mousedown).on("mouseup",WB.ul.mouseup).on("mousewheel",WB.ul.mousewheel)}WB.ul.scroll(c[0],0);WB.endProgress()},showProgress:function(){$("#mynavbar .magni").css("background-image","url(http://cdn.swook.net/css/loading.gif)")},endProgress:function(){$("#mynavbar .magni").css("background-image","url(http://cdn.swook.net/css/magni.png)")},li:{click:function(b){var a=$(WB.u);if(($.browser.msie&&b.button!=1)||(!$.browser.msie&&b.button!=0)||(b.ctrlKey)){return}b.preventDefault();if(a.data("prevY")!=a.data("startY")){return}WB.load($(this).attr("href"))}},ul:{shadow:function(c,a){var d=$(".topshadow",c),b=$(".bottomshadow",c);if(c.scrollTop==0){d.hide()}else{if(c.scrollTop>0){d.show()}}if(c.scrollTop==a){b.hide()}else{if(c.scrollTop<a){b.show()}}WB.data.scrollPos=c.scrollTop},scroll:function(d,b){if(d==undefined){d=$(WB.u)[0]}var f=$(".scrollbar",d),e=$(d).innerHeight(),a=d.scrollHeight-e,c=e/a*e;if(b!=undefined){d.scrollTop-=b}WB.ul.shadow(d,a);f.height(c);f.stop(true).animate({top:d.scrollTop/a*(e-c)+26},"fast")},mouseleave:function(){WB.delayFadeOut()},mouseenter:function(){var a=$("#topbar-search");if(!a.is(":focus")){a.focus()}WB.search()},mousemove:function(d){var g=d.pageY-this.offsetTop-window.scrollY,a=this.clientHeight,f=g-a/2,c=$(this),b=c.data("prevY");d.preventDefault();if(b!=g){if(d.which==1&&c.data("mousedown")){WB.ul.scroll(this,g-b)}$(WB.l).removeClass("hover").removeClass("nohover")}$(this).data("prevY",g)},mouseup:function(a){$(this).data("mousedown",false)},mousedown:function(b){var a=b.pageY-this.offsetTop-window.scrollY;$(this).data("mousedown",true);$(this).data("prevY",a).data("startY",a);if(b.which==1){b.preventDefault()}},mousewheel:function(c,f,b,a){c.preventDefault();WB.ul.scroll(this,a*25)}},input:{focus:function(a){if(this.value==this.defaultValue){this.value="";$(this).removeClass("defaultInput")}WB.search()},blur:function(a){if(this.value==""){this.value=this.defaultValue;$(this).addClass("defaultInput")}if(!$(WB.u).is(":hidden")){WB.fadeOut()}},keydown:function(a){if(a.keyCode==33||a.keyCode==34||a.keyCode==38||a.keyCode==40){a.preventDefault()}$(this).data("pressedKey",a.keyCode)},keyup:function(b){var a=$(this);if(a.data("pressedKey")!=b.keyCode){a.data("pressedKey",null);return}WB.input.key_switch(b);a.data("pressedKey",null)},key_switch:function(a){switch(a.keyCode){case 13:WB.input.submit();break;case 33:case 34:case 38:case 40:WB.input.keyup_arrow(a);break;case 27:WB.input.keyup_esc(a);break;default:if(a.keyCode==8||String.fromCharCode(a.keyCode)>""){WB.search()}}},keyup_arrow:function(q){q.preventDefault();var h=$(WB.l+":hover"),l=1,k=$(WB.l+".hover"),j,b,f=$(WB.u),a=$(WB.l),n=a.length;if(q.keyCode==33||q.keyCode==34){l=2}if((h.length+k.length)==0){if(q.keyCode==33||q.keyCode==38){j=n-1}else{if(q.keyCode==34||q.keyCode==40){j=0}}}else{if(k.length==0){b=a.index(h)}else{b=a.index(k)}if(q.keyCode==33||q.keyCode==38){j=b-l}else{if(q.keyCode==34||q.keyCode==40){j=b+l}}}if(j<0){if(b==0){j=n-1}else{j=0}}else{if(j>(n-1)){if(b==(n-1)){j=0}else{j=n-1}}}j=a.eq(j);a.removeClass("hover");a.addClass("nohover");j.removeClass("nohover");j.addClass("hover");var g=f[0].scrollTop,c=j[0].offsetTop,d=c-g,i=f.innerHeight(),r=i-j.innerHeight(),s,o=$(".scrollbar",f),m=f[0].scrollHeight-i,p=i/m*i;o.stop(true);if(d>r){s=c-r}else{if(d<0){s=c}}f.stop(true).animate({scrollTop:s},{step:function(e){o.css("top",e/m*(i-p)+26)},queue:false,complete:function(){WB.ul.shadow(f[0],m)}})},keyup_esc:function(a){$(this).blur();WB.fadeOut()},submit:function(){var b=$("#topbar-search").val();if(WB.data.search.length>0){var a=$(WB.l+".hover");if(a.length==0){a=$(WB.l+":hover");if(a.length==0){$(WB.l+":first").addClass("hover");WB.load(WB.data.items[WB.data.search[0].id].link);return}}WB.load(a.eq(0).attr("href"))}}},delay:function(a){if(WB.timeout){clearTimeout(WB.timeout)}WB.timeout=setTimeout(a,3000)},timeout:null,clear:function(){var a=$(WB.u);if(a.length){a.stop(true).remove()}WB.data.scrollPos=0},unhide:function(){var b=$(WB.u),a=window.innerHeight-26;b.stop(true).show().css("opacity",1).height("auto");if(b.height()>a){b.height(a)}b[0].scrollTop=WB.data.scrollPos;if(WB.timeout){clearTimeout(WB.timeout)}},hide:function(){$(this).hide();$("#topbar-search").blur();$(WB.l).removeClass("hover").removeClass("nohover")},fadeOut:function(){var a=$(WB.u);a.stop(true).fadeOut(WB.hide)},delayFadeOut:function(){var a=$(WB.u);a.stop(true);WB.delay(function(){a.fadeOut(WB.hide)})},load:function(b){var a=$('<a href="'+b+'"/>')[0];b=a.protocol+"//"+a.hostname+a.port+a.pathname;if(b!=document.location.origin+document.location.pathname){WB.showProgress()}WB.fadeOut();document.location.href=b},};$(document).ready(WB.init);