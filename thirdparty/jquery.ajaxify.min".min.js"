/*!
   jQuery Ajaxify Plugin
   --------------------------------------
   > This jQuery plugin allows reloadless surfing within a website.

   Author:  Seon-Wook Park
   Site:    http://www.swook.net/
   License: MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
(function(b){b.Ajaxify={};b.Ajaxify.init=function(){b.Ajaxify.current_url=b.Ajaxify.parseUri(document.location.href);if(b.Ajaxify.init_done){return}b.Ajaxify.initialState.url=b.Ajaxify.current_url;b.Ajaxify.initialState.title=document.title;b.Ajaxify.init_done=true};b.Ajaxify.initialState={};b.Ajaxify.url_cache={};b.Ajaxify.parseUri=function(g){if(!g||g==""){return}if((g.indexOf("://")!=-1||g[0]=="/")&&g[0]!="#"&&b.Ajaxify.url_cache[g]){return b.Ajaxify.url_cache[g]}var h={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},a=h.parser[h.strictMode?"strict":"loose"].exec(g),i={},j=14;while(j--){i[h.key[j]]=a[j]||""}i[h.q.name]={};i[h.key[12]].replace(h.q.parser,function(d,e,c){if(e){i[h.q.name][e]=c}});if(b.Ajaxify.current_url){if(i.host==""){i.protocol=(i.protocol!="")?i.protocol:((b.Ajaxify.current_url.protocol=="")?"http":b.Ajaxify.current_url.protocol);i.host=b.Ajaxify.current_url.host;i.port=(i.port!="")?i.port:((b.Ajaxify.current_url.port=="")?"":b.Ajaxify.current_url.port);i.path=(i.path!="")?i.path:((b.Ajaxify.current_url.path=="")?"":b.Ajaxify.current_url.path)}}i.full=i.protocol+"://"+i.host+((i.port=="")?"":":"+i.port)+((i.path=="")?"/":i.path)+((i.query=="")?"":"?"+i.query);i.full_anchor=i.full;if(i.anchor>""){i.full_anchor+="#"+i.anchor}b.Ajaxify.url_cache[g]=i;return i};b.Ajaxify.applyTo=function(f){if(!b.support.ajax||!window.history){return}var e=(f instanceof jQuery)?f:b(this);var a=b.Ajaxify.parseUri(e.attr("href"));if(!a||a.host!=b.Ajaxify.current_url.host){return}e.unbind("click");e.on("click",b.Ajaxify.onClick);e=null,a=null};b.Ajaxify.onClick=function(d){if((b.browser.msie&&d.button!=1)||(!b.browser.msie&&d.button!=0)||(d.ctrlKey)){return}d.preventDefault();var a=b.Ajaxify.parseUri(b(this).attr("href"));b.Ajaxify.loadURL(a)};b.Ajaxify.loadURL=function(f){if(typeof f=="string"){f=b.Ajaxify.parseUri(f)}if(!f){return}if(f.host!=b.Ajaxify.current_url.host){document.location.href=f.full;return}if(b.Ajaxify.current_url.full==f.full){b.Ajaxify.gotoAnchor(f.anchor);return}var a=b("body"),e=b("a");a.css("cursor","progress");e.each(function(d,c){var h=b(c);h.data("cursor_cache",h.css("cursor"));h.css("cursor","progress")});b.get(f.full,function(c){b.Ajaxify.updateHistory(f,c);b.Ajaxify.applyData(f,c);a.css("cursor","auto");e.each(function(i,d){var k=b(d),l=k.data("cursor_cache");k.css("cursor",(l)?l:"auto");k.removeData("cursor_cache")});c=null},"html").error(function(){document.location.href=f.full})};b.Ajaxify.applyData=function(k,i){if(!i){b.get(k.full,function(c){i=c;b.Ajaxify.applyData(k,i)},"html");return}if(!b.Ajaxify.container){b("html").empty();b("html").html(i)}else{if(typeof b.Ajaxify.container=="string"){b.Ajaxify.container=[b.Ajaxify.container]}var l,h,a=b.Ajaxify.container.length;for(var j=0;j<a;j++){h=b(b.Ajaxify.container[j]+":first",i);l=b(b.Ajaxify.container[j]+":first");l.replaceWith(h);l.height(l.height());l.height("auto");b(l,"a[target!=_blank]:not(.noajax)").each(b.Ajaxify.applyTo)}}b.Ajaxify.all();b.Ajaxify.pageChange_run();b.Ajaxify.gotoAnchor(k.anchor)};b.Ajaxify.updateHistory=function(a,f){var e=f.match(/<title>(.*?)<\/title>/)[1];document.title=e;history.pushState({url:a,title:e},e,a.relative);b.Ajaxify.init()};b.Ajaxify.gotoAnchor=function(a){if(a==""){a=0}else{a=b("#"+a+":first, a[name="+a+"]:first");if(a.length==0){return}a=a.offset().top}var d;if(b.browser.webkit){d=b("body")}else{d=b("html,body")}if(d.scrollTop()!=a){d.animate({scrollTop:a},"fast")}};b.Ajaxify.all=function(){b("a[target!=_blank]:not(.noajax)").each(b.Ajaxify.applyTo)};b.Ajaxify.pageChange_run=function(){var a=b.Ajaxify.pageChange_funcs.length;for(var d=0;d<a;d++){b.Ajaxify.pageChange_funcs[d]()}};b.Ajaxify.pageChange_funcs=[];b.Ajaxify.pageChange=function(a){b.Ajaxify.pageChange_funcs.push(a)};b(window).on("popstate",function(d){if(b.browser.webkit&&!b.Ajaxify.init_pop){b.Ajaxify.init_pop=true;return}var a=d.originalEvent.state;if(!a){a=b.Ajaxify.initialState}if(a.url.full!=b.Ajaxify.current_url.full){document.title=a.title;b.Ajaxify.init();b.Ajaxify.applyData(a.url)}});b.Ajaxify.init()})(jQuery);