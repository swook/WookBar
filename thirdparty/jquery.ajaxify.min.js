/*!
   jQuery Ajaxify Plugin
   --------------------------------------
   > This jQuery plugin allows reloadless surfing within a website.

   Author:  Seon-Wook Park
   Site:    http://www.swook.net/
   License: MIT License <http://www.opensource.org/licenses/mit-license.php>
 */
(function(a){a.Ajaxify={};a.Ajaxify.init=function(){a.Ajaxify.current_url=a.Ajaxify.parseUri(document.location.href);if(a.Ajaxify.init_done){return}a.Ajaxify.initialState.url=a.Ajaxify.current_url;a.Ajaxify.initialState.title=document.title;a.Ajaxify.init_done=true};a.Ajaxify.initialState={};a.Ajaxify.url_cache={};a.Ajaxify.parseUri=function(f){if(!f||f==""){return}if((f.indexOf("://")!=-1||f[0]=="/")&&f[0]!="#"&&a.Ajaxify.url_cache[f]){return a.Ajaxify.url_cache[f]}var e={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},b=e.parser[e.strictMode?"strict":"loose"].exec(f),d={},c=14;while(c--){d[e.key[c]]=b[c]||""}d[e.q.name]={};d[e.key[12]].replace(e.q.parser,function(h,g,i){if(g){d[e.q.name][g]=i}});if(a.Ajaxify.current_url){if(d.host==""){d.protocol=(d.protocol!="")?d.protocol:((a.Ajaxify.current_url.protocol=="")?"http":a.Ajaxify.current_url.protocol);d.host=a.Ajaxify.current_url.host;d.port=(d.port!="")?d.port:((a.Ajaxify.current_url.port=="")?"":a.Ajaxify.current_url.port);d.path=(d.path!="")?d.path:((a.Ajaxify.current_url.path=="")?"":a.Ajaxify.current_url.path)}}d.full=d.protocol+"://"+d.host+((d.port=="")?"":":"+d.port)+((d.path=="")?"/":d.path)+((d.query=="")?"":"?"+d.query);d.full_anchor=d.full;if(d.anchor>""){d.full_anchor+="#"+d.anchor}a.Ajaxify.url_cache[f]=d;return d};a.Ajaxify.applyTo=function(c){if(!a.support.ajax||!window.history){return}var d=(c instanceof jQuery)?c:a(this);var b=a.Ajaxify.parseUri(d.attr("href"));if(!b||b.host!=a.Ajaxify.current_url.host){return}d.unbind("click");d.on("click",a.Ajaxify.onClick);d=null,b=null};a.Ajaxify.onClick=function(c){if((a.browser.msie&&c.button!=1)||(!a.browser.msie&&c.button!=0)||(c.ctrlKey)){return}c.preventDefault();var b=a.Ajaxify.parseUri(a(this).attr("href"));a.Ajaxify.loadURL(b)};a.Ajaxify.loadURL=function(c){if(typeof c=="string"){c=a.Ajaxify.parseUri(c)}if(!c){return}if(c.host!=a.Ajaxify.current_url.host){document.location.href=c.full;return}if(a.Ajaxify.current_url.full==c.full){a.Ajaxify.gotoAnchor(c.anchor);return}var b=a("body"),d=a("a");b.css("cursor","progress");d.each(function(f,g){var e=a(g);e.data("cursor_cache",e.css("cursor"));e.css("cursor","progress")});a.get(c.full,function(e){a.Ajaxify.updateHistory(c,e);a.Ajaxify.applyData(c,e);b.css("cursor","auto");d.each(function(h,j){var g=a(j),f=g.data("cursor_cache");g.css("cursor",(f)?f:"auto");g.removeData("cursor_cache")});e=null},"html").error(function(){document.location.href=c.full})};a.Ajaxify.applyData=function(d,f){if(!f){a.get(d.full,function(h){f=h;a.Ajaxify.applyData(d,f)},"html");return}if(!a.Ajaxify.container){a("html").empty();a("html").html(f)}else{if(typeof a.Ajaxify.container=="string"){a.Ajaxify.container=[a.Ajaxify.container]}var c,g,b=a.Ajaxify.container.length;for(var e=0;e<b;e++){g=a(a.Ajaxify.container[e]+":first",f);c=a(a.Ajaxify.container[e]+":first");c.replaceWith(g);c.height(c.height());c.height("auto");a(c,"a[target!=_blank]:not(.noajax)").each(a.Ajaxify.applyTo)}}a.Ajaxify.all();a.Ajaxify.pageChange_run();a.Ajaxify.gotoAnchor(d.anchor)};a.Ajaxify.updateHistory=function(b,c){var d=c.match(/<title>(.*?)<\/title>/)[1];document.title=d;history.pushState({url:b,title:d},d,b.relative);a.Ajaxify.init()};a.Ajaxify.gotoAnchor=function(b){if(b==""){b=0}else{b=a("#"+b+":first, a[name="+b+"]:first");if(b.length==0){return}b=b.offset().top}var c;if(a.browser.webkit){c=a("body")}else{c=a("html,body")}if(c.scrollTop()!=b){c.animate({scrollTop:b},"fast")}};a.Ajaxify.all=function(){a("a[target!=_blank]:not(.noajax)").each(a.Ajaxify.applyTo)};a.Ajaxify.pageChange_run=function(){var b=a.Ajaxify.pageChange_funcs.length;for(var c=0;c<b;c++){a.Ajaxify.pageChange_funcs[c]()}};a.Ajaxify.pageChange_funcs=[];a.Ajaxify.pageChange=function(b){a.Ajaxify.pageChange_funcs.push(b)};a(window).on("popstate",function(c){if(a.browser.webkit&&!a.Ajaxify.init_pop){a.Ajaxify.init_pop=true;return}var b=c.originalEvent.state;if(!b){b=a.Ajaxify.initialState}if(b.url.full!=a.Ajaxify.current_url.full){document.title=b.title;a.Ajaxify.init();a.Ajaxify.applyData(b.url)}});a.Ajaxify.init()})(jQuery);